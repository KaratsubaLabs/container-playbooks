---
- hosts: local
  pre_tasks:
    - name: include public vars
      include_vars: "{{playbook_dir}}/vars/public.yml"
    - name: include private vars
      include_vars: "{{playbook_dir}}/vars/private.yml"
  tasks:
    - name: run docker compose
      docker_compose:
        project_name: "{{service_name}}"
        definition:
          version: "3"
          services:
            app:
              container_name: "{{service_name}}-app"
              image: searx/searx:latest
              environment:
                - BIND_ADDRESS=0.0.0.0:8080
              ports:
                - "{{service_port}}:8080"
              restart: always

    # this needs to be copied into container
    # either mount a volume or just run docker cp using cmd module
    # - name: copy setting.yml
    #   template:
    #     src: "{{playbook_dir}}/templates/settings.yml.j2"
    #     dest: /etc/searx/settings.yml
    #     owner: root
    #     group: root
    #     mode: 0644

